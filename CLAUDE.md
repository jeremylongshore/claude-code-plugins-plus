# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is **the comprehensive marketplace and learning hub for Claude Code plugins**. It serves as both a distribution platform for plugins and an educational resource for plugin developers.

**Repository Stats:**
- 226 marketplace plugins across 14 categories
- 221 AI instruction plugins (markdown-based templates)
- 5 MCP server plugins (TypeScript/Node.js executables with 21 tools)
- Live marketplace at https://claudecodeplugins.io/
- Monorepo using pnpm workspaces

## Critical Architecture Understanding

### Two Catalog System

This repository maintains **two separate catalog files**:

1. **`.claude-plugin/marketplace.extended.json`** (SOURCE OF TRUTH)
   - Full metadata including `featured`, `mcpTools`, `pricing`, `components`
   - Used by the Astro marketplace website
   - Edit this file when adding/updating plugins

2. **`.claude-plugin/marketplace.json`** (GENERATED FILE)
   - Sanitized version for Claude CLI compatibility
   - Auto-generated by `pnpm run sync-marketplace`
   - Contains only CLI-supported fields (strips extended metadata)
   - **NEVER edit this file directly**

### Catalog Sync Workflow

```bash
# After editing marketplace.extended.json:
pnpm run sync-marketplace  # Regenerates marketplace.json

# CI will fail if marketplace.json is out of sync
# Always run sync-marketplace before committing
```

The sync script (`scripts/sync-marketplace.cjs`) strips these fields: `featured`, `mcpTools`, `pluginCount`, `pricing`, `components`

### Monorepo Structure

This is a pnpm workspace with two separate package ecosystems:

```
claude-code-plugins/
├── plugins/mcp/                    # MCP plugins (TypeScript/Node.js)
│   ├── project-health-auditor/    # 4 MCP tools
│   ├── conversational-api-debugger/ # 4 MCP tools
│   ├── domain-memory-agent/       # 6 MCP tools
│   ├── design-to-code/            # 3 MCP tools
│   └── workflow-orchestrator/     # 4 MCP tools
├── marketplace/                    # Astro website (Node.js)
│   ├── src/                       # Astro 5.14.5 + Tailwind 4
│   └── dist/                      # Built site → GitHub Pages
└── pnpm-workspace.yaml            # Workspace config
```

## Common Development Commands

### Catalog Management

```bash
# After editing marketplace.extended.json (ALWAYS RUN THIS):
pnpm run sync-marketplace

# Validate catalogs are in sync (CI check):
node scripts/sync-marketplace.cjs
git diff --quiet .claude-plugin/marketplace.json  # Should show no changes
```

### Validation & Testing

```bash
# Comprehensive validation (run before committing):
./scripts/validate-all.sh

# Validate specific plugin/directory:
./scripts/validate-all.sh plugins/mcp/project-health-auditor/

# Test plugin installation locally:
./scripts/test-installation.sh

# Check markdown frontmatter:
python3 scripts/check-frontmatter.py

# Validate specific JSON file:
jq empty path/to/file.json
```

### MCP Plugin Development

```bash
# Install dependencies for all MCP plugins:
pnpm install

# Build all MCP plugins:
pnpm build

# Build specific MCP plugin:
cd plugins/mcp/[plugin-name]/
pnpm build

# Run tests:
pnpm test  # All plugins
cd plugins/mcp/[plugin-name]/ && pnpm test  # Specific plugin

# Type checking:
pnpm typecheck
```

### Marketplace Website Development

```bash
cd marketplace/

# Development server (http://localhost:4321):
npm run dev

# Production build:
npm run build

# Preview production build:
npm run preview
```

### Local Plugin Testing Workflow

```bash
# 1. Create test marketplace structure:
mkdir -p ~/test-marketplace/.claude-plugin

# 2. Create marketplace.json pointing to local plugin:
cat > ~/test-marketplace/.claude-plugin/marketplace.json << 'EOF'
{
  "name": "test",
  "owner": {"name": "Test"},
  "plugins": [{
    "name": "my-plugin",
    "source": "/absolute/path/to/plugins/community/my-plugin"
  }]
}
EOF

# 3. Add test marketplace to Claude Code:
/plugin marketplace add ~/test-marketplace

# 4. Install and test:
/plugin install my-plugin@test
/my-command  # Test slash commands
```

## Adding a New Plugin

### Complete Workflow

1. **Create plugin structure:**
```bash
mkdir -p plugins/community/your-plugin/.claude-plugin
mkdir -p plugins/community/your-plugin/commands  # If using commands
mkdir -p plugins/community/your-plugin/agents    # If using agents
```

2. **Create required files:**
   - `.claude-plugin/plugin.json` (metadata with name, version, description, author)
   - `README.md` (comprehensive documentation with examples)
   - `LICENSE` (MIT or Apache-2.0 recommended)
   - At least one component directory

3. **Update marketplace.extended.json (SOURCE):**
```json
{
  "plugins": [
    {
      "name": "your-plugin",
      "source": "./plugins/community/your-plugin",
      "description": "Clear one-line description",
      "version": "1.0.0",
      "category": "productivity",
      "keywords": ["keyword1", "keyword2"],
      "author": {
        "name": "Your Name",
        "email": "your.email@example.com"
      }
    }
  ]
}
```

4. **Regenerate CLI catalog:**
```bash
pnpm run sync-marketplace
```

5. **Validate:**
```bash
./scripts/validate-all.sh plugins/community/your-plugin/
jq '.plugins[] | select(.name == "your-plugin")' .claude-plugin/marketplace.json
```

6. **Test locally** using the test marketplace workflow above

7. **Submit PR** using `.github/PULL_REQUEST_TEMPLATE.md`

## Plugin Architecture Details

### AI Instruction Plugins (221 plugins)

- Markdown files with YAML frontmatter
- Work through Claude's interpretation
- No external code execution
- Categories: api-development, ai-ml, security, devops, crypto, database, testing, performance, productivity, ai-agency

**Required frontmatter for commands/agents:**
```yaml
---
name: command-name
description: What this does
model: sonnet  # or opus, haiku
---
```

### MCP Server Plugins (5 plugins)

- TypeScript/Node.js applications
- Run as separate processes
- Build with `@modelcontextprotocol/sdk`
- Compiled to JavaScript in `dist/`
- Each provides 3-6 MCP tools

**MCP plugin structure:**
```
plugin-name/
├── src/
│   └── index.ts          # Main server implementation
├── dist/                 # Compiled JavaScript (gitignored)
├── package.json          # Node.js dependencies
├── tsconfig.json         # TypeScript config
└── .claude-plugin/
    ├── plugin.json       # Plugin metadata
    └── mcp/
        └── server.json   # MCP server configuration
```

## Critical Conventions

### Path Variables

Always use `${CLAUDE_PLUGIN_ROOT}` in hooks for portable paths:
```json
{
  "hooks": {
    "PostToolUse": {
      "command": "${CLAUDE_PLUGIN_ROOT}/scripts/process.sh"
    }
  }
}
```

### Script Permissions

All shell scripts MUST be executable (validated by CI):
```bash
chmod +x scripts/*.sh
find . -type f -name "*.sh" -exec chmod +x {} \;
```

### Plugin Categories

Valid categories: `productivity`, `security`, `testing`, `deployment`, `documentation`, `analysis`, `integration`, `ai`, `devops`, `debugging`, `code-quality`, `design`, `example`, `api-development`, `database`, `crypto`, `performance`, `ai-ml`, `other`

### Versioning

Follow semantic versioning (MAJOR.MINOR.PATCH):
- `1.0.0` - Initial release
- `1.1.0` - New feature, backward compatible
- `1.1.1` - Bug fix
- `2.0.0` - Breaking change

## CI/CD Pipeline

### GitHub Actions Workflows

1. **`.github/workflows/validate-plugins.yml`** (runs on PR and main push)
   - Validates marketplace.json is in sync with marketplace.extended.json
   - Checks JSON syntax with `jq`
   - Validates plugin structure (plugin.json, README.md, LICENSE)
   - Verifies script permissions (`chmod +x`)
   - Security scans:
     - Hardcoded secrets detection
     - AWS keys detection (blocks CI)
     - Private key detection (blocks CI)
     - Dangerous command patterns (`rm -rf /`)
     - Command injection risks (`eval()`)
     - Suspicious URLs (non-HTTPS, URL shorteners)
   - MCP plugin dependency audit (`npm audit`)

2. **`.github/workflows/deploy-marketplace.yml`** (deploys to GitHub Pages)
   - Builds Astro site (`cd marketplace && npm run build`)
   - Deploys to https://claudecodeplugins.io/

3. **`.github/workflows/release.yml`** (version tagging)
   - Creates GitHub releases with changelog
   - Semantic versioning tags

### Pre-commit Checklist

Before committing changes:

```bash
# 1. Sync catalogs if you edited marketplace.extended.json:
pnpm run sync-marketplace

# 2. Run full validation:
./scripts/validate-all.sh

# 3. Make scripts executable:
find . -type f -name "*.sh" -exec chmod +x {} \;

# 4. Validate JSON:
find . -name "*.json" -exec sh -c 'jq empty {}' \;

# 5. Check for secrets:
grep -r "password\|secret\|api_key" plugins/ | grep -v placeholder
```

## Common Issues & Troubleshooting

### Marketplace Sync Failures

**Error:** CI fails with "Marketplace CLI catalog was out of date"

**Solution:**
```bash
pnpm run sync-marketplace
git add .claude-plugin/marketplace.json
git commit --amend --no-edit
```

### Plugin Not Appearing

**Checklist:**
1. Valid `plugin.json` with required fields (name, version, description, author)
2. Entry exists in `marketplace.extended.json`
3. Ran `pnpm run sync-marketplace` after adding entry
4. Plugin source path is correct relative to repo root
5. At least one component directory exists (commands/, agents/, hooks/, mcp/, or scripts/)

### Scripts Not Executing

**Common causes:**
1. Missing execute permission → `chmod +x script.sh`
2. Wrong shebang → Should be `#!/bin/bash` or `#!/usr/bin/env bash`
3. Absolute path in hooks → Use `${CLAUDE_PLUGIN_ROOT}/scripts/script.sh`

### Hooks Not Firing

**Debugging steps:**
1. Validate `hooks.json` syntax with `jq`
2. Check matcher patterns match your use case
3. Verify script path uses `${CLAUDE_PLUGIN_ROOT}`
4. Test hook script independently

### MCP Plugin Build Failures

**Common issues:**
1. Missing dependencies → `pnpm install`
2. TypeScript errors → `pnpm typecheck`
3. Wrong Node version → Use Node.js 20+
4. Missing `@modelcontextprotocol/sdk` → Check package.json

## Security Requirements

1. **Never hardcode secrets** - Use environment variables or user prompts
2. **Validate all inputs** in scripts before executing commands
3. **Use `${CLAUDE_PLUGIN_ROOT}`** for all paths in hooks
4. **Request minimal permissions** - Don't ask for system-wide access
5. **No destructive operations** without explicit user confirmation
6. **All `.sh` files must be executable** - Enforced by CI
7. **No private keys or AWS keys** - Blocks CI immediately

## File Structure Requirements

### Required Files (Every Plugin)

```
plugin-name/
├── .claude-plugin/
│   └── plugin.json              # REQUIRED: name, version, description, author
├── README.md                     # REQUIRED: Documentation with examples
├── LICENSE                       # REQUIRED: MIT or Apache-2.0 recommended
└── [commands|agents|hooks|mcp|scripts]/  # At least one component
```

### plugin.json Schema

```json
{
  "name": "plugin-name",
  "version": "1.0.0",
  "description": "Clear description",
  "author": {
    "name": "Author Name",
    "email": "author@example.com"
  },
  "repository": "https://github.com/username/repo",
  "license": "MIT",
  "keywords": ["keyword1", "keyword2"]
}
```

### Command/Agent Markdown Format

```markdown
---
name: command-name
description: Brief description
model: sonnet
---

# Command Title

Detailed instructions for Claude...
```

### Hooks Format

```json
{
  "hooks": {
    "PostToolUse": {
      "matchers": [
        {
          "tools": ["Edit", "Write"],
          "filePatterns": ["**/*.py"]
        }
      ],
      "command": "${CLAUDE_PLUGIN_ROOT}/scripts/format.sh"
    }
  }
}
```

## Package Management

### pnpm Workspace Commands

```bash
# Install dependencies for all workspace packages:
pnpm install

# Run script in all packages:
pnpm --filter '*' build
pnpm --filter '*' test

# Run script in specific package:
pnpm --filter project-health-auditor build

# Add dependency to specific package:
cd plugins/mcp/plugin-name/
pnpm add dependency-name

# Update all dependencies:
pnpm update -r
```

## Marketplace Distribution

### Installation Commands

Users install plugins from this marketplace:

```bash
# Add marketplace (GitHub shorthand):
/plugin marketplace add jeremylongshore/claude-code-plugins

# Install plugins:
/plugin install plugin-name@claude-code-plugins-plus
/plugin install devops-automation-pack@claude-code-plugins-plus
/plugin install project-health-auditor@claude-code-plugins-plus
```

### Marketplace Slug

- **Marketplace name:** `claude-code-plugins-plus`
- **GitHub repo:** `jeremylongshore/claude-code-plugins`
- **Live site:** https://claudecodeplugins.io/

## Important Context

### NOT GitHub Marketplace

Claude Code plugins use their own ecosystem with JSON-based marketplace catalogs. This repository IS a Claude Code plugin marketplace, not related to GitHub's marketplace for Actions/Apps.

### No Built-in Monetization

There is no monetization mechanism for Claude Code plugins. All plugins are free and open-source. External revenue strategies exist (consulting, support, premium versions).

### Beta Status (October 2025)

Claude Code plugins are in public beta. Features and best practices evolve. This marketplace stays updated with latest changes.

### Two Plugin Types Coexist

- **AI Instruction Plugins:** Guide Claude's behavior through markdown templates (221 plugins)
- **MCP Server Plugins:** Execute TypeScript/Node.js code in separate processes (5 plugins)

Both are valid and fully functional approaches.

## Resources

### Official Documentation
- **Claude Code Docs:** https://docs.claude.com/en/docs/claude-code/
- **Plugin Guide:** https://docs.claude.com/en/docs/claude-code/plugins
- **Plugin Reference:** https://docs.claude.com/en/docs/claude-code/plugins-reference

### Community
- **Discord:** https://discord.com/invite/6PPFFzqPDZ (#claude-code channel)
- **GitHub Issues:** https://github.com/jeremylongshore/claude-code-plugins/issues
- **GitHub Discussions:** https://github.com/jeremylongshore/claude-code-plugins/discussions

### This Repository
- **CONTRIBUTING.md** - Submission guidelines
- **SECURITY.md** - Security policy and threat model
- **CODE_OF_CONDUCT.md** - Community standards
- **USER_SECURITY_GUIDE.md** - Safe plugin evaluation
- **MCP-SERVERS-STATUS.md** - MCP plugin configurations
- **CHANGELOG.md** - Version history

## Development Principles

When working in this repository:

1. **Always sync catalogs:** Run `pnpm run sync-marketplace` after editing `marketplace.extended.json`
2. **Validate before committing:** Run `./scripts/validate-all.sh`
3. **Test locally first:** Use test marketplace pattern to verify plugins work
4. **Executable scripts:** All `.sh` files need `chmod +x` (CI enforced)
5. **JSON validation:** Use `jq empty file.json` to validate syntax
6. **Frontmatter required:** All command/agent markdown files need YAML frontmatter
7. **Portable paths:** Always use `${CLAUDE_PLUGIN_ROOT}` in hooks
8. **Documentation first:** Every plugin needs comprehensive README.md
9. **Security conscious:** No hardcoded secrets, validate inputs, minimal permissions
10. **Two-catalog awareness:** Edit `.extended.json` (source), generate `.json` (CLI)

---

**Last Updated:** October 2025
**Repository Version:** 1.0.39 (226 plugins)
**Status:** Active, accepting community contributions
