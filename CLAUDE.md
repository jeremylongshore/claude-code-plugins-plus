# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is **the comprehensive marketplace and learning hub for Claude Code plugins**. It serves as both a distribution platform for plugins and an educational resource for plugin developers.

**Repository Stats (as of 2025-11-19):**
- 253 total plugins across 18 categories
- 6 MCP server plugins (TypeScript/Node.js with 21+ tools)
- 185 plugins with Agent Skills (100% v1.2.0 - 2025 schema compliant)
- Live marketplace at https://claudecodeplugins.io/
- Monorepo using pnpm workspaces

## Quick Reference - Most Common Tasks

**Before ANY commit:**
```bash
pnpm run sync-marketplace           # If you edited marketplace.extended.json
./scripts/validate-all-plugins.sh   # Validate everything
```

**Adding a new plugin:**
```bash
# 1. Create structure
mkdir -p plugins/[category]/plugin-name/.claude-plugin

# 2. Add to marketplace.extended.json (SOURCE OF TRUTH)

# 3. Sync and validate
pnpm run sync-marketplace
./scripts/validate-all-plugins.sh plugins/[category]/plugin-name/
```

**Building MCP plugins:**
```bash
cd plugins/mcp/[plugin-name]/
pnpm install
pnpm build
```

**Deploying website:**
```bash
cd marketplace/
npm run build
# Push to main → auto-deploys via GitHub Actions
```

## Critical Architecture Understanding

### Two Catalog System (MUST UNDERSTAND)

This repository maintains **two separate catalog files** for compatibility:

1. **`.claude-plugin/marketplace.extended.json`** (SOURCE OF TRUTH)
   - Full metadata including `featured`, `mcpTools`, `pricing`, `components`, `pluginCount`
   - Used by the Astro marketplace website
   - **ALWAYS edit this file when adding/updating plugins**
   - Rich metadata enables better website presentation

2. **`.claude-plugin/marketplace.json`** (GENERATED FILE)
   - Sanitized version for Claude CLI compatibility
   - Auto-generated by `pnpm run sync-marketplace`
   - Contains only CLI-supported fields (strips extended metadata)
   - **NEVER edit this file directly** - it will be overwritten
   - This is what Claude CLI reads when users install plugins

**Why two catalogs?** The Claude CLI has a strict schema and rejects extra fields. The marketplace website needs richer metadata for features like filtering, featured plugins, and MCP tool counts. The sync script bridges these requirements.

### Catalog Sync Workflow

```bash
# After editing marketplace.extended.json:
pnpm run sync-marketplace  # Regenerates marketplace.json

# CI will fail if marketplace.json is out of sync
# Always run sync-marketplace before committing
```

The sync script (`scripts/sync-marketplace.cjs`) strips these fields: `featured`, `mcpTools`, `pluginCount`, `pricing`, `components`

### Monorepo Structure

This is a pnpm workspace with multiple package ecosystems:

```
claude-code-plugins/
├── plugins/                      # 253 plugins across 18 categories
│   ├── mcp/                     # 6 MCP plugins (TypeScript/Node.js)
│   │   ├── project-health-auditor/    # 4 MCP tools
│   │   ├── conversational-api-debugger/ # 4 MCP tools
│   │   ├── domain-memory-agent/       # 6 MCP tools
│   │   ├── design-to-code/            # 3 MCP tools
│   │   ├── workflow-orchestrator/     # 4 MCP tools
│   │   └── ai-experiment-logger/      # Tools for ML experiments
│   ├── productivity/            # Largest category (40+ plugins)
│   ├── devops/                  # DevOps automation
│   ├── security/                # Security tools
│   ├── ai-ml/                   # AI/ML tools
│   ├── database/                # Database operations
│   ├── api-development/         # API tools
│   ├── [12 more categories]/    # Various specializations
│   └── fairdb-operations-kit/   # Production PostgreSQL operations
├── marketplace/                  # Astro 5.15.6 website
│   ├── src/                     # Astro components + Tailwind 4
│   └── dist/                    # Built site → GitHub Pages
├── scripts/                      # 33 build/validation/automation scripts
├── .github/workflows/            # 8 CI/CD pipelines
├── 000-docs/                     # 50+ documentation files (flat structure)
└── pnpm-workspace.yaml          # Workspace config
```

## Common Development Commands

### Catalog Management

```bash
# After editing marketplace.extended.json (ALWAYS RUN THIS):
pnpm run sync-marketplace

# Validate catalogs are in sync (CI check):
node scripts/sync-marketplace.cjs
git diff --quiet .claude-plugin/marketplace.json  # Should show no changes
```

### Validation & Testing

```bash
# Comprehensive validation (run before committing):
./scripts/validate-all-plugins.sh

# Validate specific plugin/directory:
./scripts/validate-all-plugins.sh plugins/mcp/project-health-auditor/

# Test plugin installation locally:
./scripts/test-plugin-installation.sh

# Check markdown frontmatter:
python3 scripts/validate-frontmatter.py

# Validate skills comply with 2025 schema:
python3 scripts/validate-skills-schema.py

# Validate specific JSON file:
jq empty path/to/file.json
```

### MCP Plugin Development

**Important:** MCP plugins are TypeScript/Node.js applications that run as separate processes. They require compilation before use.

```bash
# Install dependencies for all MCP plugins:
pnpm install

# Build all MCP plugins:
pnpm build

# Build specific MCP plugin:
cd plugins/mcp/[plugin-name]/
pnpm build

# Run tests:
pnpm test  # All plugins
cd plugins/mcp/[plugin-name]/ && pnpm test  # Specific plugin

# Type checking:
pnpm typecheck

# Lint code:
pnpm lint

# Development mode (watch mode):
pnpm dev
```

**MCP Plugin Build Output:**
- Source code in `src/` (TypeScript)
- Compiled code in `dist/` (JavaScript, gitignored)
- Each plugin is an independent npm package in the pnpm workspace
- Must be built before testing or deployment

### Marketplace Website Development

```bash
cd marketplace/

# Development server (http://localhost:4321):
npm run dev

# Production build:
npm run build

# Preview production build:
npm run preview

# Generate missing plugin pages:
node generate-missing-plugins.cjs

# Generate plugin content:
node generate-content.js
```

### Agent Skills Management (v1.2.0+)

```bash
# Migrate skills to 2025 schema (adds allowed-tools and version):
python3 scripts/migrate-skills-schema.py

# Validate all skills comply with 2025 schema:
python3 scripts/validate-skills-schema.py

# Generate skills for next plugin in queue:
./scripts/skills-process-next.sh

# Generate skills using Vertex AI (safe mode with backups):
python3 scripts/skills-generate-vertex-safe.py

# Fix plugin manifests (remove invalid fields):
./scripts/fix-all-manifests.sh
```

**How Skills Generation Works:**

The repository uses an automated batch processing system to generate Agent Skills:

1. **SQLite Database Tracking** (`backups/skills_generation.db`):
   - Tracks 253 plugins with status (pending, processing, completed, failed)
   - Stores skill metadata and generation history
   - Automatic backups before each generation run

2. **Daily Automation** (`.github/workflows/daily-skill-generator.yml`):
   - Runs at 10 AM UTC (5 AM EST) daily
   - Finds next plugin needing skills
   - Creates GitHub issue with generation task
   - Uses Vertex AI Gemini 2.0 Flash API
   - Filters: devops, security, testing, ai-ml categories first

3. **Quality Assurance**:
   - Average SKILL.md size: 3,210 bytes (17x Anthropic's standard examples)
   - Includes multi-phase workflows, trigger phrases, code examples
   - YAML validation ensures 2025 schema compliance
   - All 185 skills 100% compliant with 2025 schema

### Scripts Organization

Scripts follow a categorized naming convention in flat structure:

- **Validation**: `validate-*.sh/py` - Plugin structure and compliance checks
- **Skills**: `skills-*.sh/py` - Agent Skills generation and management
- **Auditing**: `audit-*.sh` - Plugin manifest and structure auditing
- **Fixes**: `fix-*.sh/py` - Automated fixes for common issues
- **Migration**: `migrate-*.sh/py` - Schema and structure migrations
- **Utilities**: `util-*.sh/py/pl` - General utilities (e.g., emoji removal)
- **Enhancement**: `enhance-*.sh` - Plugin enhancements
- **Automation**: `automation-*.sh` - CI/CD automation scripts

### Local Plugin Testing Workflow

```bash
# 1. Create test marketplace structure:
mkdir -p ~/test-marketplace/.claude-plugin

# 2. Create marketplace.json pointing to local plugin:
cat > ~/test-marketplace/.claude-plugin/marketplace.json << 'EOF'
{
  "name": "test",
  "owner": {"name": "Test"},
  "plugins": [{
    "name": "my-plugin",
    "source": "/absolute/path/to/plugins/community/my-plugin"
  }]
}
EOF

# 3. Add test marketplace to Claude Code:
/plugin marketplace add ~/test-marketplace

# 4. Install and test:
/plugin install my-plugin@test
/my-command  # Test slash commands
```

## Adding a New Plugin

### Complete Workflow

1. **Determine category** (18 available):
   - productivity, security, testing, deployment, documentation, analysis
   - integration, ai, devops, debugging, code-quality, design
   - example, api-development, database, crypto, performance, ai-ml
   - skill-enhancers, business-tools, finance, life-sciences, other

2. **Create plugin structure:**
```bash
mkdir -p plugins/[category]/your-plugin/.claude-plugin
mkdir -p plugins/[category]/your-plugin/commands  # If using commands
mkdir -p plugins/[category]/your-plugin/agents    # If using agents
mkdir -p plugins/[category]/your-plugin/skills/skill-adapter  # For Agent Skills
```

3. **Create required files:**
   - `.claude-plugin/plugin.json` (metadata with name, version, description, author)
   - `README.md` (comprehensive documentation with examples)
   - `LICENSE` (MIT or Apache-2.0 recommended)
   - At least one component directory

4. **Update marketplace.extended.json (SOURCE):**
```json
{
  "plugins": [
    {
      "name": "your-plugin",
      "source": "./plugins/[category]/your-plugin",
      "description": "Clear one-line description",
      "version": "1.0.0",
      "category": "[category]",
      "keywords": ["keyword1", "keyword2"],
      "author": {
        "name": "Your Name",
        "email": "your.email@example.com"
      }
    }
  ]
}
```

5. **Regenerate CLI catalog:**
```bash
pnpm run sync-marketplace
```

6. **Validate:**
```bash
./scripts/validate-all-plugins.sh plugins/[category]/your-plugin/
jq '.plugins[] | select(.name == "your-plugin")' .claude-plugin/marketplace.json
```

7. **Test locally** using the test marketplace workflow above

8. **Submit PR** using `.github/PULL_REQUEST_TEMPLATE.md`

## Plugin Architecture Details

### Three Plugin Types Coexist

1. **AI Instruction Plugins** (majority of plugins)
   - Markdown files with YAML frontmatter
   - Work through Claude's interpretation
   - No external code execution
   - Fast, simple, low-risk

2. **MCP Server Plugins** (6 plugins)
   - TypeScript/Node.js applications
   - Run as separate processes
   - Build with `@modelcontextprotocol/sdk`
   - Compiled to JavaScript in `dist/`
   - Each provides 3-6 MCP tools

3. **Agent Skills** (185 plugins equipped)
   - Model-invoked capabilities that activate automatically
   - Based on trigger phrases in conversation
   - Placed in `skills/[skill-name]/SKILL.md` directory structure
   - 2025 schema compliant with tool restrictions

### Agent Skills (2025 Schema)

**SKILL.md frontmatter (2025 schema):**
```yaml
---
name: skill-name
description: |
  What this skill does and when to use it.
  Include clear trigger phrases like "analyze code quality" or "optimize performance"
  so users know when this skill will activate.
allowed-tools: Read, Write, Edit, Grep, Bash  # Limits which tools skill can use
version: 1.0.0  # Semantic versioning for skill updates
---
```

**Tool Permission Categories:**
- **Read-only analysis**: `Read, Grep, Glob, Bash`
- **Code editing**: `Read, Write, Edit, Grep, Glob, Bash`
- **Web research**: `Read, WebFetch, WebSearch, Grep`
- **Database ops**: `Read, Write, Bash, Grep`
- **Testing**: `Read, Bash, Grep, Glob`

## Critical Conventions

### Path Variables

Always use `${CLAUDE_PLUGIN_ROOT}` in hooks for portable paths:
```json
{
  "hooks": {
    "PostToolUse": {
      "command": "${CLAUDE_PLUGIN_ROOT}/scripts/process.sh"
    }
  }
}
```

### Script Permissions

All shell scripts MUST be executable (validated by CI):
```bash
chmod +x scripts/*.sh
find . -type f -name "*.sh" -exec chmod +x {} \;
```

### Model Identifiers

**Important:** As of v1.0.46, the `opus` model identifier has been deprecated:
- Use `sonnet` for advanced reasoning tasks
- Use `haiku` for simple, fast tasks
- Never use `opus` (will cause errors)

### Versioning

Follow semantic versioning (MAJOR.MINOR.PATCH). Version must be updated in:
1. `VERSION` file (root)
2. `package.json` (root)
3. `.claude-plugin/marketplace.extended.json` (metadata.version)
4. Individual plugin `plugin.json` files (when updating plugins)

## CI/CD Pipeline

### GitHub Actions Workflows (8 total)

1. **validate-plugins.yml** - Runs on PR and main push
   - Validates marketplace.json sync
   - JSON syntax validation
   - Plugin structure checks
   - Security scans (blocks on AWS keys, private keys)
   - Script executability

2. **daily-skill-generator.yml** - Daily at 10 AM UTC
   - Finds plugins needing skills
   - Creates GitHub issues
   - Uses Vertex AI for generation

3. **deploy-marketplace.yml** - On marketplace/ changes
   - Builds Astro site
   - Deploys to GitHub Pages

4. **release.yml** - Manual dispatch
   - Semantic versioning
   - Creates GitHub releases

5. **automerge.yml** - Dependabot PR automation

6. **maintainer-ready-automerge.yml** - Labeled PR automation

7. **security-audit.yml** - CodeQL and dependency scanning

8. **codeql.yml** - Static security analysis

### Pre-commit Checklist

```bash
# 1. Sync catalogs if you edited marketplace.extended.json:
pnpm run sync-marketplace

# 2. Run full validation:
./scripts/validate-all-plugins.sh

# 3. Make scripts executable:
find . -type f -name "*.sh" -exec chmod +x {} \;

# 4. Validate JSON:
find . -name "*.json" -exec sh -c 'jq empty {}' \;

# 5. Check for secrets:
grep -r "password\|secret\|api_key" plugins/ | grep -v placeholder

# 6. Verify model identifiers (no 'opus'):
grep -r "model: opus" plugins/
# Should return empty - replace with 'sonnet' if found
```

## Common Issues & Troubleshooting

### Marketplace Sync Failures

**Error:** CI fails with "Marketplace CLI catalog was out of date"

**Solution:**
```bash
pnpm run sync-marketplace
git add .claude-plugin/marketplace.json
git commit --amend --no-edit
```

### Plugin Not Appearing

**Checklist:**
1. Valid `plugin.json` with required fields (name, version, description, author)
2. Entry exists in `marketplace.extended.json`
3. Ran `pnpm run sync-marketplace` after adding entry
4. Plugin source path is correct relative to repo root
5. At least one component directory exists

### MCP Plugin Build Failures

**Common issues:**
1. Missing dependencies → `pnpm install`
2. TypeScript errors → `pnpm typecheck`
3. Wrong Node version → Use Node.js 20+
4. Missing `@modelcontextprotocol/sdk` → Check package.json

### Invalid Model Identifier Errors

**Error:** Plugin fails with "Invalid model: opus"

**Solution:**
```bash
# Find all instances:
grep -r "model: opus" plugins/

# Replace with sonnet or haiku, then:
./scripts/validate-all-plugins.sh
pnpm run sync-marketplace
```

## Security Requirements

1. **Never hardcode secrets** - Use environment variables or user prompts
2. **Validate all inputs** in scripts before executing commands
3. **Use `${CLAUDE_PLUGIN_ROOT}`** for all paths in hooks
4. **Request minimal permissions** - Don't ask for system-wide access
5. **No destructive operations** without explicit user confirmation
6. **All `.sh` files must be executable** - Enforced by CI
7. **No private keys or AWS keys** - Blocks CI immediately
8. **Agent Skills security** - Use `allowed-tools` to restrict permissions

## Marketplace Distribution

### Installation Commands

Users install plugins from this marketplace:

```bash
# Add marketplace (GitHub shorthand):
/plugin marketplace add jeremylongshore/claude-code-plugins

# Install plugins:
/plugin install plugin-name@claude-code-plugins-plus
/plugin install devops-automation-pack@claude-code-plugins-plus
/plugin install project-health-auditor@claude-code-plugins-plus
```

### Marketplace Identifiers

- **Marketplace name:** `claude-code-plugins-plus`
- **GitHub repo:** `jeremylongshore/claude-code-plugins`
- **Live site:** https://claudecodeplugins.io/

## Documentation Filing System

This repository uses a structured filing system in `/000-docs/`:

**Format:** `NNN-CC-ABCD-description.ext`
- **NNN** = Sequence number (001-999)
- **CC** = Category code (AT, PP, LS, RA, OD, etc.)
- **ABCD** = Document type (ADEC, GUID, PROD, etc.)

See Document Filing System v3.0 in prompts-intent-solutions master-systems folder for full specification.

## Development Principles

When working in this repository:

1. **Always sync catalogs:** Run `pnpm run sync-marketplace` after editing `marketplace.extended.json`
2. **Validate before committing:** Run `./scripts/validate-all-plugins.sh`
3. **Test locally first:** Use test marketplace pattern
4. **Executable scripts:** All `.sh` files need `chmod +x`
5. **JSON validation:** Use `jq empty file.json`
6. **Frontmatter required:** All markdown components need YAML frontmatter
7. **Portable paths:** Use `${CLAUDE_PLUGIN_ROOT}` in hooks
8. **Documentation first:** Every plugin needs comprehensive README.md
9. **Security conscious:** No hardcoded secrets, validate inputs
10. **Two-catalog awareness:** Edit `.extended.json` (source), generate `.json` (CLI)

## Key Workflows

### Adding a Plugin with Agent Skills

```bash
# 1. Create plugin structure
mkdir -p plugins/[category]/my-plugin/.claude-plugin
mkdir -p plugins/[category]/my-plugin/commands
mkdir -p plugins/[category]/my-plugin/skills/skill-adapter

# 2. Create plugin.json, README.md, LICENSE, commands/

# 3. Generate Agent Skill
./scripts/skills-process-next.sh  # Interactive skill generation

# 4. Update marketplace
# Edit .claude-plugin/marketplace.extended.json
pnpm run sync-marketplace

# 5. Validate
./scripts/validate-all-plugins.sh plugins/[category]/my-plugin/

# 6. Test locally using test marketplace workflow

# 7. Commit and PR
git add .
git commit -m "feat: add my-plugin with Agent Skills"
```

### Creating a Release

```bash
# 1. Update version numbers in VERSION, package.json, marketplace.extended.json

# 2. Update CHANGELOG.md

# 3. Sync marketplace
pnpm run sync-marketplace

# 4. Validate everything
./scripts/validate-all-plugins.sh

# 5. Commit version bump
git commit -m "chore: bump version to x.y.z"

# 6. Create tag
git tag -a vx.y.z -m "Release vx.y.z"

# 7. Push with tags
git push origin main --tags

# GitHub Actions creates release automatically
```

## Resources

### Official Documentation
- **Claude Code Docs:** https://docs.claude.com/en/docs/claude-code/
- **Plugin Guide:** https://docs.claude.com/en/docs/claude-code/plugins
- **Plugin Reference:** https://docs.claude.com/en/docs/claude-code/plugins-reference

### Repository Documentation
- **CONTRIBUTING.md** - Submission guidelines
- **SECURITY.md** - Security policy and threat model
- **CHANGELOG.md** - Version history
- **SETUP.md** - Development environment setup
- **scripts/PRODUCTION_SAFETY_GUIDE.md** - Production deployment
- **scripts/SKILLS_AUTOMATION.md** - Skills generation docs
- **000-docs/** - 50+ internal documentation files

### Community
- **Discord:** https://discord.com/invite/6PPFFzqPDZ (#claude-code channel)
- **GitHub Issues:** https://github.com/jeremylongshore/claude-code-plugins/issues
- **GitHub Discussions:** https://github.com/jeremylongshore/claude-code-plugins/discussions

---

**Last Updated:** November 19, 2025
**Repository Version:** 1.3.3 (253 plugins, 185 with Agent Skills)
**Status:** Active, accepting community contributions