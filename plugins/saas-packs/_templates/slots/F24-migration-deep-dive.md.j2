---
name: {{ company }}-migration-deep-dive
description: |
  {{ display_name }} major re-architecture and migration strategies.
  Use when migrating to {{ display_name }} or performing major version upgrades.
  Trigger with phrases like "migrate {{ company }}", "{{ company }} migration",
  "switch to {{ company }}", "{{ company }} replatform".
allowed-tools: Read, Write, Edit, Bash({{ company }}:*)
version: 1.0.0
license: MIT
author: Jeremy Longshore <jeremy@intentsolutions.io>
---

# {{ display_name }} Migration Deep Dive

## Overview
Comprehensive guide for migrating to or from {{ display_name }}, or major version upgrades.

## Prerequisites
- {{ company }}-install-auth completed
- Current system fully documented
- Test environment available
- Rollback plan defined

## Instructions

### Step 1: Migration Types

| Type | Complexity | Duration | Risk |
|------|-----------|----------|------|
| Fresh install | Low | Days | Low |
| From competitor | Medium | Weeks | Medium |
| Major version | Medium | Weeks | Medium |
| Full replatform | High | Months | High |

## Pre-Migration Assessment

### 1. Current State Analysis
```bash
# Document current implementation
find . -name "*.ts" -o -name "*.py" | xargs grep -l "{{ company }}" > {{ company }}-files.txt

# Count integration points
wc -l {{ company }}-files.txt

# Identify dependencies
npm list | grep {{ company }}
pip freeze | grep {{ company }}
```

### 2. Data Inventory
```typescript
interface MigrationInventory {
  dataTypes: string[];
  recordCounts: Record<string, number>;
  dependencies: string[];
  integrationPoints: string[];
  customizations: string[];
}

async function assess{{ display_name }}Migration(): Promise<MigrationInventory> {
  return {
    dataTypes: await getDataTypes(),
    recordCounts: await getRecordCounts(),
    dependencies: await analyzeDependencies(),
    integrationPoints: await findIntegrationPoints(),
    customizations: await documentCustomizations(),
  };
}
```

## Migration Strategy: Strangler Fig Pattern

```
Phase 1: Parallel Run
┌─────────────┐     ┌─────────────┐
│   Old       │     │   New       │
│   System    │ ──▶ │  {{ display_name }}   │
│   (100%)    │     │   (0%)      │
└─────────────┘     └─────────────┘

Phase 2: Gradual Shift
┌─────────────┐     ┌─────────────┐
│   Old       │     │   New       │
│   (50%)     │ ──▶ │   (50%)     │
└─────────────┘     └─────────────┘

Phase 3: Complete
┌─────────────┐     ┌─────────────┐
│   Old       │     │   New       │
│   (0%)      │ ──▶ │   (100%)    │
└─────────────┘     └─────────────┘
```

## Implementation Plan

### Phase 1: Setup (Week 1-2)
```bash
# Install {{ display_name }} SDK
npm install {{ npm_package | default(company + '-sdk') }}

# Configure credentials
cp .env.example .env.{{ company }}
# Edit with new credentials

# Verify connectivity
node -e "require('{{ npm_package | default(company + '-sdk') }}').ping()"
```

### Phase 2: Adapter Layer (Week 3-4)
```typescript
// src/adapters/{{ company }}.ts
interface ServiceAdapter {
  create(data: CreateInput): Promise<Resource>;
  read(id: string): Promise<Resource>;
  update(id: string, data: UpdateInput): Promise<Resource>;
  delete(id: string): Promise<void>;
}

class {{ display_name }}Adapter implements ServiceAdapter {
  async create(data: CreateInput): Promise<Resource> {
    const {{ company }}Data = this.transform(data);
    return {{ company }}Client.create({{ company }}Data);
  }

  private transform(data: CreateInput): {{ display_name }}Input {
    // Map from old format to {{ display_name }} format
  }
}
```

### Phase 3: Data Migration (Week 5-6)
```typescript
async function migrate{{ display_name }}Data(): Promise<MigrationResult> {
  const batchSize = 100;
  let processed = 0;
  let errors: MigrationError[] = [];

  for await (const batch of oldSystem.iterateBatches(batchSize)) {
    try {
      const transformed = batch.map(transform);
      await {{ company }}Client.batchCreate(transformed);
      processed += batch.length;
    } catch (error) {
      errors.push({ batch, error });
    }

    // Progress update
    console.log(`Migrated ${processed} records`);
  }

  return { processed, errors };
}
```

### Phase 4: Traffic Shift (Week 7-8)
```typescript
// Feature flag controlled traffic split
function getServiceAdapter(): ServiceAdapter {
  const {{ company }}Percentage = getFeatureFlag('{{ company }}_migration_percentage');

  if (Math.random() * 100 < {{ company }}Percentage) {
    return new {{ display_name }}Adapter();
  }

  return new LegacyAdapter();
}
```

## Rollback Plan

```bash
# Immediate rollback
kubectl set env deployment/app {{ company | upper }}_ENABLED=false
kubectl rollout restart deployment/app

# Data rollback (if needed)
./scripts/restore-from-backup.sh --date YYYY-MM-DD

# Verify rollback
curl https://app.yourcompany.com/health | jq '.services.{{ company }}'
```

### Step 2: Post-Migration Validation

```typescript
async function validate{{ display_name }}Migration(): Promise<ValidationReport> {
  const checks = [
    { name: 'Data count match', fn: checkDataCounts },
    { name: 'API functionality', fn: checkApiFunctionality },
    { name: 'Performance baseline', fn: checkPerformance },
    { name: 'Error rates', fn: checkErrorRates },
  ];

  const results = await Promise.all(
    checks.map(async c => ({ name: c.name, result: await c.fn() }))
  );

  return { checks: results, passed: results.every(r => r.result.success) };
}
```

## Output
- Migration plan documented and approved
- Data migrated with validation
- Traffic shifted gradually
- Rollback tested and documented

## Error Handling

| Error | Cause | Solution |
|-------|-------|----------|
| Data mismatch | Transform error | Review transformation logic, re-migrate |
| Performance regression | Missing optimization | Profile and optimize new implementation |
| Integration failures | API incompatibility | Update adapter layer for compatibility |
| Rollback needed | Critical issue found | Execute rollback procedure |

## Examples

### Migration Progress Tracking

```typescript
interface MigrationProgress {
  phase: string;
  recordsTotal: number;
  recordsMigrated: number;
  errors: number;
  startTime: Date;
  estimatedCompletion: Date;
}

async function trackMigrationProgress(): Promise<MigrationProgress> {
  const total = await oldSystem.count();
  const migrated = await {{ company }}Client.count();
  const errors = await getMigrationErrors();

  return {
    phase: 'data-migration',
    recordsTotal: total,
    recordsMigrated: migrated,
    errors: errors.length,
    startTime: migrationStartTime,
    estimatedCompletion: estimateCompletion(migrated, total),
  };
}
```

## Resources
- [{{ display_name }} Migration Guide]({{ docs_url | default('https://docs.' + company + '.com') }}/migration)
- [Data Import API]({{ docs_url | default('https://docs.' + company + '.com') }}/import)
- [Migration Best Practices]({{ docs_url | default('https://docs.' + company + '.com') }}/migration-best-practices)

## Flagship+ Skills
For advanced troubleshooting, see `{{ company }}-advanced-troubleshooting`.
