---
name: {{ company }}-security-basics
description: |
  {{ display_name }} security best practices for secrets and access control.
  Trigger phrases: "{{ company }} security", "{{ company }} secrets",
  "secure {{ company }}", "{{ company }} API key security".
allowed-tools: Read, Write, Grep
version: 1.0.0
license: MIT
author: Jeremy Longshore <jeremy@intentsolutions.io>
---

# {{ display_name }} Security Basics

## Overview
Security best practices for {{ display_name }} API keys, tokens, and access control.

## Secret Management

### Environment Variables (Required)
```bash
# .env (NEVER commit to git)
{{ company | upper }}_API_KEY=sk_live_***
{{ company | upper }}_SECRET=***

# .gitignore
.env
.env.local
.env.*.local
```

### Secret Rotation
```bash
# 1. Generate new key in {{ display_name }} dashboard
# 2. Update environment variable
export {{ company | upper }}_API_KEY="new_key_here"

# 3. Verify new key works
curl -H "Authorization: Bearer ${{ company | upper }}_API_KEY" \
  {{ api_url | default('https://api.' + company + '.com') }}/health

# 4. Revoke old key in dashboard
```

## Least Privilege Principle

### Scope Recommendations
| Environment | Recommended Scopes |
|-------------|-------------------|
| Development | `{{ dev_scopes | default('read:*') }}` |
| Staging | `{{ staging_scopes | default('read:*, write:limited') }}` |
| Production | `{{ prod_scopes | default('Only required scopes') }}` |

### Service Account Pattern
```typescript
// Use separate API keys per service/environment
const clients = {
  reader: new {{ client_class | default(display_name + 'Client') }}({
    apiKey: process.env.{{ company | upper }}_READ_KEY,
  }),
  writer: new {{ client_class | default(display_name + 'Client') }}({
    apiKey: process.env.{{ company | upper }}_WRITE_KEY,
  }),
};
```

## Audit Logging

```typescript
// Log all {{ display_name }} operations (without secrets)
function logOperation(operation: string, params: Record<string, any>) {
  const sanitized = { ...params };
  delete sanitized.apiKey;
  delete sanitized.token;

  console.log(JSON.stringify({
    timestamp: new Date().toISOString(),
    service: '{{ company }}',
    operation,
    params: sanitized,
  }));
}
```

## Security Checklist

- [ ] API keys stored in environment variables
- [ ] `.env` files in `.gitignore`
- [ ] Different keys for dev/staging/prod
- [ ] Minimal scopes per environment
- [ ] Audit logging enabled
- [ ] Regular key rotation schedule
- [ ] IP allowlist configured (if available)
- [ ] Webhook signatures validated

## Common Security Mistakes

### ❌ Don't Do This
```typescript
// NEVER hardcode API keys
const client = new {{ client_class | default(display_name + 'Client') }}({
  apiKey: 'sk_live_actual_key_here', // BAD!
});

// NEVER log API keys
console.log('Using key:', process.env.{{ company | upper }}_API_KEY); // BAD!

// NEVER commit .env files
git add .env  // BAD!
```

### ✅ Do This Instead
```typescript
// Use environment variables
const client = new {{ client_class | default(display_name + 'Client') }}({
  apiKey: process.env.{{ company | upper }}_API_KEY,
});

// Log presence, not value
console.log('API key configured:', !!process.env.{{ company | upper }}_API_KEY);
```

## Webhook Security

```typescript
import crypto from 'crypto';

function verifyWebhookSignature(
  payload: string,
  signature: string,
  secret: string
): boolean {
  const expected = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');

  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expected)
  );
}
```

## Next Steps
For production deployment, see `{{ company }}-prod-checklist`.
