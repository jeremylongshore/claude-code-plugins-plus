---
name: {{ company }}-multi-env-setup
description: |
  {{ display_name }} multi-environment setup for dev/staging/prod configuration.
  Use when setting up {{ display_name }} across multiple environments.
  Trigger with phrases like "{{ company }} environments", "{{ company }} staging",
  "{{ company }} multi-env", "{{ company }} dev setup".
allowed-tools: Read, Write, Edit, Bash({{ company }}:*)
version: 1.0.0
license: MIT
author: Jeremy Longshore <jeremy@intentsolutions.io>
---

# {{ display_name }} Multi-Environment Setup

## Overview
Configure {{ display_name }} across development, staging, and production environments.

## Prerequisites
- {{ company }}-install-auth completed
- Access to {{ display_name }} dashboard for all environments
- Environment variable management system (dotenv, Vault, etc.)
- Separate API keys per environment

## Instructions

### Step 1: Environment Configuration Structure

```
config/
├── {{ company }}.development.json
├── {{ company }}.staging.json
├── {{ company }}.production.json
└── {{ company }}.base.json       # Shared settings
```

### Step 2: Environment-Specific Config

```typescript
// config/{{ company }}.ts
import { merge } from 'lodash';

interface {{ display_name }}Config {
  apiKey: string;
  environment: 'development' | 'staging' | 'production';
  baseUrl: string;
  timeout: number;
  retries: number;
  debug: boolean;
}

const baseConfig = require('./{{ company }}.base.json');

export function get{{ display_name }}Config(): {{ display_name }}Config {
  const env = process.env.NODE_ENV || 'development';
  const envConfig = require(`./{{ company }}.${env}.json`);

  return merge({}, baseConfig, envConfig, {
    apiKey: process.env.{{ company | upper }}_API_KEY!,
  });
}
```

### Step 3: Environment Variables

```bash
# .env.development
{{ company | upper }}_API_KEY=sk_dev_***
{{ company | upper }}_ENV=development
{{ company | upper }}_DEBUG=true

# .env.staging
{{ company | upper }}_API_KEY=sk_staging_***
{{ company | upper }}_ENV=staging
{{ company | upper }}_DEBUG=true

# .env.production
{{ company | upper }}_API_KEY=sk_live_***
{{ company | upper }}_ENV=production
{{ company | upper }}_DEBUG=false
```

### Step 4: Environment Detection

```typescript
function get{{ display_name }}Environment(): 'development' | 'staging' | 'production' {
  // Check explicit env var first
  const explicit = process.env.{{ company | upper }}_ENV;
  if (explicit) return explicit as any;

  // Fall back to NODE_ENV
  switch (process.env.NODE_ENV) {
    case 'production': return 'production';
    case 'staging': return 'staging';
    default: return 'development';
  }
}
```

## Output
- Isolated {{ display_name }} configurations per environment
- Environment-specific API keys and settings
- Debug logging enabled for non-production
- Consistent configuration loading across codebase

## Error Handling

| Error | Cause | Solution |
|-------|-------|----------|
| Wrong API key for env | Mismatched key/environment | Verify API key prefix matches environment |
| Config file not found | Missing environment config | Create config file for environment |
| Environment detection fail | NODE_ENV not set | Set NODE_ENV or {{ company | upper }}_ENV explicitly |
| Cross-env data access | Using prod key in staging | Audit API key usage, use key validation |

## Examples

### Kubernetes ConfigMap

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ company }}-config
data:
  {{ company | upper }}_ENV: "production"
  {{ company | upper }}_BASE_URL: "{{ api_url | default('https://api.' + company + '.com') }}"
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ company }}-secrets
stringData:
  {{ company | upper }}_API_KEY: "sk_live_***"
```

### GitHub Actions per Environment

```yaml
jobs:
  deploy-staging:
    environment: staging
    env:
      {{ company | upper }}_API_KEY: ${{ '{{' }} secrets.{{ company | upper }}_API_KEY_STAGING {{ '}}' }}

  deploy-production:
    environment: production
    needs: deploy-staging
    env:
      {{ company | upper }}_API_KEY: ${{ '{{' }} secrets.{{ company | upper }}_API_KEY_PROD {{ '}}' }}
```

## Resources
- [{{ display_name }} Environments Guide]({{ docs_url | default('https://docs.' + company + '.com') }}/environments)
- [API Key Management]({{ docs_url | default('https://docs.' + company + '.com') }}/api-keys)
- [Configuration Best Practices]({{ docs_url | default('https://docs.' + company + '.com') }}/configuration)

## Next Steps
For observability across environments, see `{{ company }}-observability`.
