---
name: {{ company }}-upgrade-migration
description: |
  Analyze and execute {{ display_name }} SDK version upgrades with breaking change migrations.
  Use when updating to a new SDK version or handling deprecations.
  Trigger with phrases like "upgrade {{ company }}", "{{ company }} migration",
  "{{ company }} breaking changes", "update {{ company }} SDK".
allowed-tools: Read, Write, Edit, Bash({{ company }}:*)
version: 1.0.0
license: MIT
author: Jeremy Longshore <jeremy@intentsolutions.io>
---

# {{ display_name }} Upgrade & Migration

## Overview
Guide for upgrading {{ display_name }} SDK versions and handling breaking changes.

## Prerequisites
- Current integration working
- Test suite passing
- Git repository with clean working directory
- Changelog reviewed for target version

## Instructions

### Step 1: Check Current and Available Versions
```bash
# Current installed version
npm list {{ npm_package | default(company + '-sdk') }}

# Latest available version
npm view {{ npm_package | default(company + '-sdk') }} version

# Check for breaking changes
npm view {{ npm_package | default(company + '-sdk') }} changelog
```

### Step 2: Create Upgrade Branch
```bash
git checkout -b upgrade/{{ company }}-sdk-vX.Y.Z
npm install {{ npm_package | default(company + '-sdk') }}@latest
npm test
```

### Step 3: Handle Breaking Changes

**Import Changes:**
```typescript
// Before (v1.x)
import { Client } from '{{ npm_package | default(company + '-sdk') }}';

// After (v2.x)
import { {{ client_class | default(display_name + 'Client') }} } from '{{ npm_package | default(company + '-sdk') }}';
```

**Configuration Changes:**
```typescript
// Before (v1.x)
const client = new Client({ key: 'xxx' });

// After (v2.x)
const client = new {{ client_class | default(display_name + 'Client') }}({
  apiKey: 'xxx',
  {{ new_options | default('// New required options') }}
});
```

### Step 4: Run Codemods (If Available)
```bash
npx @{{ company }}/codemod --transform v1-to-v2
```

## Output
- SDK upgraded to target version
- All breaking changes addressed
- Test suite passing
- Migration documented for team

## Error Handling

| Error | Cause | Solution |
|-------|-------|----------|
| TypeScript errors | API signature changes | Update method calls per changelog |
| Test failures | Behavior changes | Update tests to match new behavior |
| Runtime errors | Missing config | Add new required configuration |
| Deprecation warnings | Old API usage | Migrate to new API patterns |

## Examples

### Version Compatibility Matrix

| SDK Version | API Version | Node.js | Breaking Changes |
|-------------|-------------|---------|------------------|
| {{ v3_sdk | default('3.x') }} | {{ v3_api | default('2024-01') }} | {{ v3_node | default('18+') }} | {{ v3_breaking | default('Major refactor') }} |
| {{ v2_sdk | default('2.x') }} | {{ v2_api | default('2023-06') }} | {{ v2_node | default('16+') }} | {{ v2_breaking | default('Auth changes') }} |
| {{ v1_sdk | default('1.x') }} | {{ v1_api | default('2022-01') }} | {{ v1_node | default('14+') }} | {{ v1_breaking | default('Initial release') }} |

### Deprecation Handling
```typescript
// Find deprecated usage
const DEPRECATED_PATTERNS = [
  {{ deprecated_patterns | default("'client.oldMethod'") }},
];

// Suppress warnings during migration (temporary)
process.env.{{ company | upper }}_SUPPRESS_DEPRECATION = 'true';
```

### Rollback Plan
```bash
# Keep old version pinned
npm install {{ npm_package | default(company + '-sdk') }}@1.x.x --save-exact

# Document rollback command
echo "Rollback: npm install {{ npm_package | default(company + '-sdk') }}@1.x.x"
```

### Migration Checklist
- [ ] Read full changelog for target version
- [ ] Create upgrade branch
- [ ] Update package.json
- [ ] Fix TypeScript compilation errors
- [ ] Update configuration code
- [ ] Fix breaking API changes
- [ ] Run full test suite
- [ ] Test in staging environment
- [ ] Deploy with rollback plan ready
- [ ] Monitor for errors post-deployment

## Resources
- [{{ display_name }} Changelog]({{ changelog_url | default('https://github.com/' + company + '/sdk/releases') }})
- [Migration Guide]({{ docs_url | default('https://docs.' + company + '.com') }}/migration)
- [Breaking Changes]({{ docs_url | default('https://docs.' + company + '.com') }}/breaking-changes)

## Next Steps
For CI integration during upgrades, see `{{ company }}-ci-integration`.
