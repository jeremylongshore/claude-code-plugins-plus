---
name: {{ company }}-ci-integration
description: |
  Configure {{ display_name }} CI/CD integration with GitHub Actions and testing.
  Use when setting up automated testing or continuous integration.
  Trigger with phrases like "{{ company }} CI", "{{ company }} GitHub Actions",
  "{{ company }} automated tests", "CI {{ company }}".
allowed-tools: Read, Write, Edit, Bash({{ company }}:*)
version: 1.0.0
license: MIT
author: Jeremy Longshore <jeremy@intentsolutions.io>
---

# {{ display_name }} CI Integration

## Overview
Set up CI/CD pipelines for {{ display_name }} integrations with automated testing.

## Prerequisites
- GitHub repository with actions enabled
- {{ company }}-install-auth completed
- Test suite configured
- Access to GitHub repository settings

## Instructions

### Step 1: Add Secrets to GitHub
```bash
gh secret set {{ company | upper }}_API_KEY --body "sk_test_***"
gh secret set {{ company | upper }}_API_KEY_STAGING -e staging
gh secret set {{ company | upper }}_API_KEY_PROD -e production
```

### Step 2: Create Workflow File
Create `.github/workflows/{{ company }}-integration.yml`:

```yaml
name: {{ display_name }} Integration Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  {{ company | upper }}_API_KEY: ${{ '{{' }} secrets.{{ company | upper }}_API_KEY {{ '}}' }}

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - name: Install dependencies
        run: npm ci
      - name: Run unit tests
        run: npm test -- --coverage
      - name: Run {{ display_name }} integration tests
        run: npm run test:integration
```

### Step 3: Configure Integration Tests
```typescript
// tests/integration/{{ company }}.test.ts
import { describe, it, expect, beforeAll } from 'vitest';

describe('{{ display_name }} Integration', () => {
  const hasApiKey = !!process.env.{{ company | upper }}_API_KEY;

  it.skipIf(!hasApiKey)('should connect to {{ display_name }} API', async () => {
    const client = get{{ display_name }}Client();
    const result = await client.healthCheck();
    expect(result.status).toBe('ok');
  });
});
```

## Output
- GitHub Actions workflow running on push/PR
- Integration tests validating {{ display_name }} connectivity
- Coverage reports uploaded to Codecov
- Branch protection rules enforcing tests

## Error Handling

| Error | Cause | Solution |
|-------|-------|----------|
| Secret not found | Missing GitHub secret | Add secret with `gh secret set` |
| Integration test skipped | No API key in CI | Configure repository secrets |
| Workflow failed | Test failure | Check test output and fix |
| Rate limit in CI | Too many test runs | Use test API key with higher limits |

## Examples

### Release Workflow
```yaml
name: Release
on:
  push:
    tags: ['v*']

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Verify {{ display_name }} production readiness
        run: npm run verify:{{ company }}
        env:
          {{ company | upper }}_API_KEY: ${{ '{{' }} secrets.{{ company | upper }}_API_KEY_PROD {{ '}}' }}
      - name: Build and publish
        run: npm ci && npm run build && npm publish
```

### PR Check Configuration
```yaml
# Branch protection rule requirements
required_status_checks:
  - "test"
  - "{{ company }}-integration"
```

## Resources
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [{{ display_name }} CI Guide]({{ docs_url | default('https://docs.' + company + '.com') }}/ci)
- [Codecov Documentation](https://docs.codecov.com/)

## Next Steps
For deployment patterns, see `{{ company }}-deploy-integration`.
